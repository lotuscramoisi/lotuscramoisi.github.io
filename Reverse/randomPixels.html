<!DOCTYPE html>
<html lang="en">
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet" />
<script src="../assets/js/prism.js"></script>
<script src="../assets/js/prism-python.min.js"></script>

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CTF Writeup Template</title>
<style>
:root {
  --bg:#0e0f13; --fg:#e6e6e6; --muted:#9aa0a6;
  --accent:#7dd3fc; --edge:#3b4252; --node:#a78bfa;
  --badge:#1f2937; --highlight:#facc15;
  --color-code-background:#111318; --color-link:#7dd3fc;
  --highlight-foreground:#60a5fa; --highlight-nav:#7dd3fc33;
  --cursor-pointer:pointer; --global-theme:#f59e0b;
}
.home-btn { text-decoration: none; color: var(--accent); background: var(--badge); padding: 6px 12px; border-radius: 6px; border: 1px solid var(--edge); font-weight: bold; transition: 0.3s; }
.home-btn:hover { background: var(--accent); color: var(--bg); }
body{margin:0;font-family:ui-sans-serif,system-ui;background:var(--bg);color:var(--fg)}
header{padding:16px;border-bottom:1px solid #1f2430;display:flex;align-items:center;justify-content:space-between;background:#111318}
h1{margin:0;font-size:24px}
.container{display:grid;grid-template-columns:1fr 360px;gap:16px;padding:16px}
aside{border-left:1px solid #1f2430;padding:16px;overflow-y:auto;background:#111318;box-shadow:-2px 0 8px rgba(0,0,0,0.3)}
.post{padding:12px;border:1px solid #232838;border-radius:10px;margin-bottom:12px;background:#181b22;box-shadow:0 2px 6px rgba(0,0,0,0.35)}
.post h4{margin:0 0 6px 0}.post .meta{font-size:12px;color:var(--muted);display:flex;gap:8px;flex-wrap:wrap}
.badge{font-size:14px;background:var(--badge);padding:6px 10px;margin-right:10px;border-radius:6px;border:1px solid #2b3242}
.article-entry{margin-bottom:24px}
.article-entry code,.article-entry kbd{font-family:'JetBrains Mono','Menlo','Monaco','Consolas','monospace';font-size:95%;transition:0.3s;word-break:break-word;background:var(--color-code-background);padding:1px 5px;border-radius:5px;color:var(--color-link)}
.article-entry pre[class*="language-"]{ background: var(--color-code-background) !important; border-radius:0}
.article-entry pre code{background:none;text-shadow:none;color:var(--fg);padding:0}
.article-entry .highlight{overflow:hidden;interpolate-size:allow-keywords}
.article-entry .highlight.code-closed pre{height:0;opacity:0;overflow:hidden}
.code-area{width:100%;overflow:hidden;transition:0.3s;border-radius:10px;border:2px solid #232838;background:#111318;margin-bottom:16px}
.code-figcaption{width:100%;display:flex;justify-content:space-between;height:40px;align-items:center;flex-shrink:0;background:linear-gradient(to right, transparent 0%, var(--bg) 50%, transparent 100%);margin-bottom:10px;padding:0 8px;position:relative}
.code-left-wrap,.code-right-wrap{display:flex;align-items:center}
.code-copy,.code-lang,.code-expand{margin:5px; padding-right: 12px; z-index:1;filter:invert(50%);cursor:var(--cursor-pointer);color:#fff;transition:0.3s}
.code-copy:hover,.code-expand:hover{opacity:.7}
.code-expand{transform:rotate(0deg)}
.code-closed .code-expand{transform:rotate(-180deg)!important;transition:0.3s}

</style>
</head>
<body>
<header>
  <a href="../index.html" class="home-btn">üè† Home</a>
  <h1>RandomPixels</h1>
  <div id="current-legend"><span class="badge">WEB</span></div>
</header>
<div class="container">
  <main class="article-entry">
    <section>
      <h2>Introduction</h2>
      <p>For this challenge, we are given a very small snipet of python code and an encrypted image. Source code:</p>
    </section>
    <section>
      <div class="code-area">
        <div class="code-figcaption">
          <div class="code-left-wrap"><span class="code-lang">bash</span></div>
          <div class="code-right-wrap"><span class="code-copy">Copy</span></div>
        </div>
        <pre><code class="language-python">import random, time, numpy
from PIL import Image
from secret import FLAG

def randomize(img, seed):
	random.seed(seed)
	new_y = list(range(img.shape[0]))
	new_x = list(range(img.shape[1]))
	random.shuffle(new_y)
	random.shuffle(new_x)

	new = numpy.empty_like(img)
	for i, y in enumerate(new_y):
		for j, x in enumerate(new_x):
			new[i][j] = img[y][x]
	return numpy.array(new)


if __name__ == "__main__":
	with Image.open(FLAG) as f:
		img = numpy.array(f)
		out = randomize(img, int(time.time()))
		image = Image.fromarray(out)
		image.save("encrypted.png")</code></pre>
      </div>
    </section>

    <section>
      <p>The first intitution for reverse challenges is to check how the seed is created. In this case, it is based on the python time library.</p>
      <div class="code-area">
        <div class="code-figcaption">
          <div class="code-left-wrap"><span class="code-lang">bash</span></div>
          <div class="code-right-wrap"><span class="code-copy">Copy</span></div>
        </div>
        <pre><code> seed(int(time.time())) </code></pre>
      </div>
    </section>
    <p>To unscramble the image, we need to determine when it was created to retrieve the original seed. To do this, I used 7z with the following command: </p>
   <section>
    
      <div class="code-area">
        <div class="code-figcaption">
          <div class="code-left-wrap"><span class="code-lang">bash</span></div>
          <div class="code-right-wrap"><span class="code-copy">Copy</span></div>
        </div>
        <pre><code> 7z l chal.zip
  Path = chal.zip
  Type = zip
  Physical Size = 22367

    Date      Time    Attr         Size   Compressed  Name
  ------------------- ----- ------------ ------------  ------------------------
  2024-09-29 14:18:22 .....          583          312  enc.py
  2024-10-02 23:02:40 .....        22113        21683  encrypted.png
  ------------------- ----- ------------ ------------  ------------------------
  2024-10-02 23:02:40              22696        21995  2 files
  </code></pre>
      </div>
    </section>
    <p>Now that we have the time we can make a small script in oder to unscramble those pixels:</p>
    <section>
      <div class="code-area">
        <div class="code-figcaption">
          <div class="code-left-wrap"><span class="code-lang">bash</span></div>
          <div class="code-right-wrap"><span class="code-copy">Copy</span></div>
        </div>
        <pre><code class="language-python">import random
import numpy as np
from PIL import Image
import time
from datetime import datetime

def reverse_randomize(encrypted_img, seed):
    random.seed(seed)
    new_y = list(range(encrypted_img.shape[0]))
    new_x = list(range(encrypted_img.shape[1]))
    random.shuffle(new_y)
    random.shuffle(new_x)

    original = np.empty_like(encrypted_img)
    
    # Create a mapping of shuffled positions back to original positions
    for i, y in enumerate(new_y):
        for j, x in enumerate(new_x):
            original[y][x] = encrypted_img[i][j]
    
    return original

if __name__ == "__main__":
    with Image.open("encrypted.png") as f:
        encrypted_img = np.array(f)
        
        # Here we use the date found in the 7z for the encrypted png.
        target_time_str = "2024-10-02 23:02:40"
        target_time = datetime.strptime(target_time_str, "%Y-%m-%d %H:%M:%S")
        seed = int(target_time.timestamp())
        original_img = reverse_randomize(encrypted_img, seed)
        image = Image.fromarray(original_img)
        image.save("decrypted.png")

  </code></pre>
      </div>
    </section>
    And tadaaaammm we get an unscramble imaged that looks like a QrCode.
    <section>
      <h2>Conclusion</h2>
      <p>Using the time function is very insecure for any form of encryption. We get a QRCode as our result and once scanned, it reveals the flag:</p>
        <div class="image-box">
            <img src="../assets/images/randomPixelsQRCode.JPG" alt="Random Pixels Solution">
        </div>
      <pre><code>ironCTF{p53ud0_r4nd0m_f0r_4_r3450n}</code></pre>
    </section>
  </main>
  <aside>
    <h3>Related Writeups</h3>
    <div id="related-posts">
      <div class="post"><h4><a href="#" style="color: var(--global-theme); text-decoration: none;">Web Basics</a></h4><div class="meta"><span>2024-07-01</span><span class="badge" style="background:#60a5fa22;border-color:#60a5fa55">WEB</span></div></div>
      <div class="post"><h4><a href="#" style="color: var(--global-theme); text-decoration: none;">JWT None Attack</a></h4><div class="meta"><span>2024-10-01</span><span class="badge" style="background:#60a5fa22;border-color:#60a5fa55">WEB</span></div></div>
    </div>
  </aside>
</div>
</body>
</html>

<script>
document.querySelectorAll('.code-copy').forEach(btn => {
  btn.addEventListener('click', () => {
    const codeArea = btn.closest('.code-area');
    if (!codeArea) return;

    const codeBlock = codeArea.querySelector('pre code');
    if (!codeBlock) return;

    navigator.clipboard.writeText(codeBlock.innerText).then(() => {
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy', 1500);
    }).catch(err => console.error('Failed to copy text: ', err));
  });
});
</script>
